# Issue 20832: comparison of permutation and list: unexpected result

archive/issues_020832.json:
```json
{
    "body": "CC:  sage-combinat @darijgr @nthiery simonking\n\n\n```\nsage: Permutations([0])[0] == [0]\nFalse\n```\n\nThis is unexpected as\n\n```\nsage: Permutations([0])[0], [0]\n([0], [0])\n```\n\nBoth have the same string representation and\n\n```\nsage: Permutations([0])[0].parent()\nPermutations of the set [0]\n```\n\nso it is a SageObject and some coercion or whatever should go on on comparison.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21069\n\n",
    "created_at": "2016-07-21T07:22:27Z",
    "labels": [
        "coercion",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "comparison of permutation and list: unexpected result",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20832",
    "user": "@dkrenn"
}
```
CC:  sage-combinat @darijgr @nthiery simonking


```
sage: Permutations([0])[0] == [0]
False
```

This is unexpected as

```
sage: Permutations([0])[0], [0]
([0], [0])
```

Both have the same string representation and

```
sage: Permutations([0])[0].parent()
Permutations of the set [0]
```

so it is a SageObject and some coercion or whatever should go on on comparison.

Issue created by migration from https://trac.sagemath.org/ticket/21069





---

archive/issue_comments_287813.json:
```json
{
    "body": "I think this is more an issue with the default `_cmp_` in `ClonableArray` wanting to have a common parent, but there are not coercions between most combinatorial objects (nor should there be typically). IMO, this is even worse:\n\n```\nsage: Permutations([1])[0] == Permutation([1])\nFalse\n```\n\nHowever, I don't agree with the argument that \"same representation => equality\". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.",
    "created_at": "2016-07-21T14:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287813",
    "user": "@tscrim"
}
```

I think this is more an issue with the default `_cmp_` in `ClonableArray` wanting to have a common parent, but there are not coercions between most combinatorial objects (nor should there be typically). IMO, this is even worse:

```
sage: Permutations([1])[0] == Permutation([1])
False
```

However, I don't agree with the argument that "same representation => equality". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.



---

archive/issue_comments_287814.json:
```json
{
    "body": "Replying to [comment:1 tscrim]:\n> However, I don't agree with the argument that \"same representation => equality\". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.\n\nOk, I agree.",
    "created_at": "2016-08-11T12:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287814",
    "user": "@dkrenn"
}
```

Replying to [comment:1 tscrim]:
> However, I don't agree with the argument that "same representation => equality". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.

Ok, I agree.



---

archive/issue_comments_287815.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-11T12:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287815",
    "user": "@dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287816.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-11T12:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287816",
    "user": "@dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_287817.json:
```json
{
    "body": "Set to invalid.",
    "created_at": "2016-08-11T12:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287817",
    "user": "@dkrenn"
}
```

Set to invalid.



---

archive/issue_comments_287818.json:
```json
{
    "body": "I am going to recycle this ticket to address the issue above.",
    "created_at": "2016-08-11T12:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287818",
    "user": "@tscrim"
}
```

I am going to recycle this ticket to address the issue above.



---

archive/issue_comments_287819.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-11T12:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287819",
    "user": "@tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_287820.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> I am going to recycle this ticket to address the issue above.\n\nOk.",
    "created_at": "2016-08-11T12:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287820",
    "user": "@dkrenn"
}
```

Replying to [comment:4 tscrim]:
> I am going to recycle this ticket to address the issue above.

Ok.



---

archive/issue_comments_287821.json:
```json
{
    "body": "While I was at it, I fixed the `Permutations_nk.random_element`, which was returning elements of `[0, ..., n-1]`.\n----\nNew commits:",
    "created_at": "2016-08-21T02:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287821",
    "user": "@tscrim"
}
```

While I was at it, I fixed the `Permutations_nk.random_element`, which was returning elements of `[0, ..., n-1]`.
----
New commits:



---

archive/issue_comments_287822.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-21T02:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287822",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_287823.json:
```json
{
    "body": "I just realized the branch is named wrong...",
    "created_at": "2016-08-21T02:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287823",
    "user": "@tscrim"
}
```

I just realized the branch is named wrong...



---

archive/issue_comments_287824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-23T18:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287825.json:
```json
{
    "body": "\n```\n+                    if list(n) == range(1, len(n)+1):\n```\n\nMaybe you want `sorted(n)` rather than `list(n)` here?",
    "created_at": "2016-09-03T04:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287825",
    "user": "@darijgr"
}
```


```
+                    if list(n) == range(1, len(n)+1):
```

Maybe you want `sorted(n)` rather than `list(n)` here?



---

archive/issue_comments_287826.json:
```json
{
    "body": "No, I want `list(n)` because the identity permutations are different.",
    "created_at": "2016-09-03T04:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287826",
    "user": "@tscrim"
}
```

No, I want `list(n)` because the identity permutations are different.



---

archive/issue_comments_287827.json:
```json
{
    "body": "Oh, the word \"permutation\" is meant in the non-algebraic meaning! Makes sense then. Will look at the rest of the code now.",
    "created_at": "2016-09-03T04:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287827",
    "user": "@darijgr"
}
```

Oh, the word "permutation" is meant in the non-algebraic meaning! Makes sense then. Will look at the rest of the code now.



---

archive/issue_comments_287828.json:
```json
{
    "body": "OK. Two issues:\n\n1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?\n\n2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?",
    "created_at": "2016-09-03T04:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287828",
    "user": "@darijgr"
}
```

OK. Two issues:

1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?

2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?



---

archive/issue_comments_287829.json:
```json
{
    "body": "Replying to [comment:12 darij]:\n> OK. Two issues:\n> \n> 1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?\n\nNo because nobody should be using `_set` (nor do we have to respect it) because it is hidden.\n\n> 2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?\n\nI don't understand what you're asking. If you're saying putting `StandardPermutations_n` as a superclass of `Permutations_set`, then we should not do that. It is too much of a can of worms and far outside the scope of this ticket.",
    "created_at": "2016-09-03T16:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287829",
    "user": "@tscrim"
}
```

Replying to [comment:12 darij]:
> OK. Two issues:
> 
> 1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?

No because nobody should be using `_set` (nor do we have to respect it) because it is hidden.

> 2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?

I don't understand what you're asking. If you're saying putting `StandardPermutations_n` as a superclass of `Permutations_set`, then we should not do that. It is too much of a can of worms and far outside the scope of this ticket.



---

archive/issue_comments_287830.json:
```json
{
    "body": "1. OK.\n\n2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.",
    "created_at": "2016-09-03T16:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287830",
    "user": "@darijgr"
}
```

1. OK.

2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.



---

archive/issue_comments_287831.json:
```json
{
    "body": "Replying to [comment:14 darij]:\n> 2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.\n\nThere are already such tests, so it really should not unless you're constantly doing things like `[1,2,...,n,'a']`. I also doubt it would be the bottleneck in a loop.",
    "created_at": "2016-09-03T16:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287831",
    "user": "@tscrim"
}
```

Replying to [comment:14 darij]:
> 2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.

There are already such tests, so it really should not unless you're constantly doing things like `[1,2,...,n,'a']`. I also doubt it would be the bottleneck in a loop.



---

archive/issue_comments_287832.json:
```json
{
    "body": "OK, the slowdown is in the single-digit percentages (just checked). The code LGTM then. To be safe, what do the guardians of the object hierarchy think about it?",
    "created_at": "2016-09-07T16:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287832",
    "user": "@darijgr"
}
```

OK, the slowdown is in the single-digit percentages (just checked). The code LGTM then. To be safe, what do the guardians of the object hierarchy think about it?



---

archive/issue_comments_287833.json:
```json
{
    "body": "2 failing doctests, see bot",
    "created_at": "2016-10-16T19:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287833",
    "user": "@fchapoton"
}
```

2 failing doctests, see bot



---

archive/issue_comments_287834.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-16T19:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287834",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_287835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-17T02:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287835",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287836.json:
```json
{
    "body": "Failure was due to me not using Python3-style list. Fixed and doctests now pass.\n\nSince there were no comments from Darij's request in comment:16, I'm allowing myself to set this to a positive review.",
    "created_at": "2016-10-17T02:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287836",
    "user": "@tscrim"
}
```

Failure was due to me not using Python3-style list. Fixed and doctests now pass.

Since there were no comments from Darij's request in comment:16, I'm allowing myself to set this to a positive review.



---

archive/issue_comments_287837.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-17T02:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287837",
    "user": "@tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_287838.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20832#issuecomment-287838",
    "user": "@vbraun"
}
```

Resolution: fixed
