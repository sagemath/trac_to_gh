# Issue 20832: comparison of permutation and list: unexpected result

Issue created by migration from https://trac.sagemath.org/ticket/21069

Original creator: dkrenn

Original creation time: 2016-07-21 07:22:27

CC:  sage-combinat darij nthiery simonking


```
sage: Permutations([0])[0] == [0]
False
```

This is unexpected as

```
sage: Permutations([0])[0], [0]
([0], [0])
```

Both have the same string representation and

```
sage: Permutations([0])[0].parent()
Permutations of the set [0]
```

so it is a SageObject and some coercion or whatever should go on on comparison.


---

Comment by tscrim created at 2016-07-21 14:51:31

I think this is more an issue with the default `_cmp_` in `ClonableArray` wanting to have a common parent, but there are not coercions between most combinatorial objects (nor should there be typically). IMO, this is even worse:

```
sage: Permutations([1])[0] == Permutation([1])
False
```

However, I don't agree with the argument that "same representation => equality". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.


---

Comment by dkrenn created at 2016-08-11 12:43:45

Replying to [comment:1 tscrim]:
> However, I don't agree with the argument that "same representation => equality". Should the partition `[2, 1]` equal the permutation `[2, 1]`? (Currently they do, but I think that is a small issue and you should not rely on this behavior.) We run into a major notation problem as there is not enough valid syntax and math notation to separate the two clearly; context (or their parents) separate them.

Ok, I agree.


---

Comment by dkrenn created at 2016-08-11 12:43:45

Changing status from new to needs_review.


---

Comment by dkrenn created at 2016-08-11 12:44:16

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2016-08-11 12:44:16

Set to invalid.


---

Comment by tscrim created at 2016-08-11 12:52:05

I am going to recycle this ticket to address the issue above.


---

Comment by tscrim created at 2016-08-11 12:52:05

Changing status from positive_review to needs_work.


---

Comment by dkrenn created at 2016-08-11 12:56:54

Replying to [comment:4 tscrim]:
> I am going to recycle this ticket to address the issue above.

Ok.


---

Comment by tscrim created at 2016-08-21 02:21:33

While I was at it, I fixed the `Permutations_nk.random_element`, which was returning elements of `[0, ..., n-1]`.
----
New commits:


---

Comment by tscrim created at 2016-08-21 02:21:33

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-08-21 02:39:46

I just realized the branch is named wrong...


---

Comment by git created at 2016-08-23 18:35:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-09-03 04:33:52


```
+                    if list(n) == range(1, len(n)+1):
```

Maybe you want `sorted(n)` rather than `list(n)` here?


---

Comment by tscrim created at 2016-09-03 04:35:44

No, I want `list(n)` because the identity permutations are different.


---

Comment by darij created at 2016-09-03 04:41:26

Oh, the word "permutation" is meant in the non-algebraic meaning! Makes sense then. Will look at the rest of the code now.


---

Comment by darij created at 2016-09-03 04:50:42

OK. Two issues:

1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?

2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?


---

Comment by tscrim created at 2016-09-03 16:16:25

Replying to [comment:12 darij]:
> OK. Two issues:
> 
> 1. Instances of class `Permutations_set` have a `_set` attribute, whereas objects of class `StandardPermutations_n` don't. Could this break things?

No because nobody should be using `_set` (nor do we have to respect it) because it is hidden.

> 2. Is the time to call `StandardPermutations_n` higher than for `Permutations_set`? (I suspect it is, if only due to things like `cat = FiniteWeylGroups().Irreducible() & FinitePermutationGroups()`.) Is this relevant?

I don't understand what you're asking. If you're saying putting `StandardPermutations_n` as a superclass of `Permutations_set`, then we should not do that. It is too much of a can of worms and far outside the scope of this ticket.


---

Comment by darij created at 2016-09-03 16:32:54

1. OK.

2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.


---

Comment by tscrim created at 2016-09-03 16:38:16

Replying to [comment:14 darij]:
> 2. What I mean is that calling `Permutations([1,2,3])` might now suddenly be taking a lot longer. I don't know whether this is an actual issue because (a) I haven't tested, and (b) it is a parent, and maybe calling many parents is not a standard use case we should be optimizing for anyway. But I'm asking to be sure.

There are already such tests, so it really should not unless you're constantly doing things like `[1,2,...,n,'a']`. I also doubt it would be the bottleneck in a loop.


---

Comment by darij created at 2016-09-07 16:13:31

OK, the slowdown is in the single-digit percentages (just checked). The code LGTM then. To be safe, what do the guardians of the object hierarchy think about it?


---

Comment by chapoton created at 2016-10-16 19:11:01

2 failing doctests, see bot


---

Comment by chapoton created at 2016-10-16 19:11:01

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-10-17 02:38:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-10-17 02:40:37

Failure was due to me not using Python3-style list. Fixed and doctests now pass.

Since there were no comments from Darij's request in comment:16, I'm allowing myself to set this to a positive review.


---

Comment by tscrim created at 2016-10-17 02:40:37

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-10-21 07:04:25

Resolution: fixed
