# Issue 13133: Bug in K.units() for K a number field

Issue created by migration from https://trac.sagemath.org/ticket/13305

Original creator: caruso

Original creation time: 2012-07-27 11:52:04

Assignee: davidloeffler

CC:  caruso

Keywords: units number fields

Here is the bug.


```
sage: K = QQ[sqrt(2)]
sage: U = K.units(); U
[sqrt2 + 1]
sage: del U[0]
sage: K.units()
[]
```


It is fixed by the attached patch.


---

Attachment


---

Comment by caruso created at 2012-07-27 11:53:54

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-07-27 20:38:34

Please fill in your real name as Author.


---

Comment by robharron created at 2013-03-17 20:29:16

As an alternative, one could store self.!__units and self.!__units_no_proof as tuples instead of lists (tuples are immutable). Is there a reason not to do this?


---

Comment by robharron created at 2013-04-03 18:33:39

I decided to check what other methods of number fields do and was dismayed... The same bug occurs for .embeddings for instance. I think I've come across this issue with some parents' .zero_element methods, too. Is this normal?

Replying to [comment:4 robharron]:
> As an alternative, one could store self.!__units and self.!__units_no_proof as tuples instead of lists (tuples are immutable). Is there a reason not to do this?


---

Comment by pbruin created at 2013-10-04 19:54:42

Replying to [comment:4 robharron]:
> As an alternative, one could store self.!__units and self.!__units_no_proof as tuples instead of lists (tuples are immutable). Is there a reason not to do this?
That sounds like the right solution to me.


---

Comment by jdemeyer created at 2013-10-29 07:54:51

Changing status from needs_review to needs_work.


---

Comment by AlexGhitza created at 2014-04-24 13:32:54

The implementation of Rob's idea is attached.


---

Comment by AlexGhitza created at 2014-04-24 13:35:07

Changing status from needs_work to needs_review.


---

Comment by AlexGhitza created at 2014-04-24 13:35:07

New commits:


---

Comment by pbruin created at 2014-04-24 14:35:58

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2014-04-24 14:35:58

Looks good, but there are doctest failures:

```
sage -t --long src/doc/de/tutorial/tour_numtheory.rst  # 1 doctest failed
sage -t --long src/doc/fr/tutorial/tour_numtheory.rst  # 1 doctest failed
sage -t --long src/doc/en/tutorial/tour_numtheory.rst  # 1 doctest failed
sage -t --long src/doc/ru/tutorial/tour_numtheory.rst  # 1 doctest failed
```

They all look like this:

```
File "src/doc/de/tutorial/tour_numtheory.rst", line 160, in doc.de.tutorial.tour_numtheory
Failed example:
    K.units()
Expected:
    [3*a^2 + 13*a + 13]
Got:
    (3*a^2 + 13*a + 13,)
```



---

Comment by git created at 2014-04-24 22:46:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by AlexGhitza created at 2014-04-24 22:46:58

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2014-04-24 22:54:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-25 14:20:46

Resolution: fixed
