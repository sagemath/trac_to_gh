# Issue 20978: Periodic piecewise functions

archive/issues_020978.json:
```json
{
    "body": "CC:  kcrisman tscrim ares novoselt rws vbraun pbruin burcin jdemeyer\n\nI propose to add periodic piecewise functions (for now, of a single real variable).\n\nI see two main ways of doing so:\n\n (1) By extending `piecewise`. \n\n (2) By making a suitably general symbolic mod function (#9935) and having the user combine it with a piecewise function. (This is how it is done in Mathematica, it appears - http://community.wolfram.com/groups/-/m/t/156025)\n\nIssue created by migration from https://trac.sagemath.org/ticket/21215\n\n",
    "created_at": "2016-08-10T20:49:26Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "title": "Periodic piecewise functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20978",
    "user": "mkoeppe"
}
```
CC:  kcrisman tscrim ares novoselt rws vbraun pbruin burcin jdemeyer

I propose to add periodic piecewise functions (for now, of a single real variable).

I see two main ways of doing so:

 (1) By extending `piecewise`. 

 (2) By making a suitably general symbolic mod function (#9935) and having the user combine it with a piecewise function. (This is how it is done in Mathematica, it appears - http://community.wolfram.com/groups/-/m/t/156025)

Issue created by migration from https://trac.sagemath.org/ticket/21215





---

archive/issue_comments_290357.json:
```json
{
    "body": "My vote is for 1). As you seem to have a use case can you be please more detailed?",
    "created_at": "2016-08-11T07:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290357",
    "user": "rws"
}
```

My vote is for 1). As you seem to have a use case can you be please more detailed?



---

archive/issue_comments_290358.json:
```json
{
    "body": "Replying to [comment:1 rws]:\n> My vote is for 1). \nGlad to hear; this is what I would strongly prefer too.\n\nRight now the result of `piecewise` has SR as its parent. Can this be changed so that it is in a more specific parent or category?\n\n> As you seem to have a use case can you be please more detailed?\nMy first use case is in subadditive periodic piecewise linear functions, the periodic extensions of what can be seen here:\nhttps://www.math.ucdavis.edu/~mkoeppe/art/infinite-group/compendium.png\nThey appear in integer optimization. See https://www.math.ucdavis.edu/~mkoeppe/art/infinite-group/ for more info if you're interested. I have some existing Sage code.\n\nGeneralizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.\nExamples are `ceil` and `floor`. \n\nThere is an algebraic viewpoint using group actions on this as well, which is useful for further generalizations, in particular for piecewise functions of several variables (#20877).",
    "created_at": "2016-08-11T23:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290358",
    "user": "mkoeppe"
}
```

Replying to [comment:1 rws]:
> My vote is for 1). 
Glad to hear; this is what I would strongly prefer too.

Right now the result of `piecewise` has SR as its parent. Can this be changed so that it is in a more specific parent or category?

> As you seem to have a use case can you be please more detailed?
My first use case is in subadditive periodic piecewise linear functions, the periodic extensions of what can be seen here:
https://www.math.ucdavis.edu/~mkoeppe/art/infinite-group/compendium.png
They appear in integer optimization. See https://www.math.ucdavis.edu/~mkoeppe/art/infinite-group/ for more info if you're interested. I have some existing Sage code.

Generalizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.
Examples are `ceil` and `floor`. 

There is an algebraic viewpoint using group actions on this as well, which is useful for further generalizations, in particular for piecewise functions of several variables (#20877).



---

archive/issue_comments_290359.json:
```json
{
    "body": "Replying to [comment:2 mkoeppe]:\n> Right now the result of `piecewise` has SR as its parent. Can this be changed so that it is in a more specific parent or category?\n\nPossibly we can enforce Sage's convention to give back the same type as the type of the input. Meanwhile you can do `ret = f(); if ret.is_numeric(): ret = ret.pyobject()` because the type is already preserved.\n\n> Generalizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.\n\nYou are certainly aware that if they have one periodic piece they can be all expressed in terms of `floor`. Multiple pieces can be done by a combination of `floor` and `piecewise` I think.",
    "created_at": "2016-08-12T07:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290359",
    "user": "rws"
}
```

Replying to [comment:2 mkoeppe]:
> Right now the result of `piecewise` has SR as its parent. Can this be changed so that it is in a more specific parent or category?

Possibly we can enforce Sage's convention to give back the same type as the type of the input. Meanwhile you can do `ret = f(); if ret.is_numeric(): ret = ret.pyobject()` because the type is already preserved.

> Generalizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.

You are certainly aware that if they have one periodic piece they can be all expressed in terms of `floor`. Multiple pieces can be done by a combination of `floor` and `piecewise` I think.



---

archive/issue_comments_290360.json:
```json
{
    "body": "Replying to [comment:3 rws]:\n> Replying to [comment:2 mkoeppe]:\n> > Generalizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.\n> \n> You are certainly aware that if they have one periodic piece they can be all expressed in terms of `floor`. Multiple pieces can be done by a combination of `floor` and `piecewise` I think.\n\nI guess it depends on the application whether one should consider a quasiperiodic function as a periodic+floor or as a periodic+linear. The latter is better for asymptotics. This matters for my second application, certain counting functions (http://arxiv.org/pdf/1011.6002v1.pdf page 21). \nSage should provide easy access to the corresponding direct sum decompositions of quasiperiodic functions.",
    "created_at": "2016-08-12T07:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290360",
    "user": "mkoeppe"
}
```

Replying to [comment:3 rws]:
> Replying to [comment:2 mkoeppe]:
> > Generalizing slightly, I would actually like support for quasiperiodic piecewise functions -- that is, periodic plus a linear function.
> 
> You are certainly aware that if they have one periodic piece they can be all expressed in terms of `floor`. Multiple pieces can be done by a combination of `floor` and `piecewise` I think.

I guess it depends on the application whether one should consider a quasiperiodic function as a periodic+floor or as a periodic+linear. The latter is better for asymptotics. This matters for my second application, certain counting functions (http://arxiv.org/pdf/1011.6002v1.pdf page 21). 
Sage should provide easy access to the corresponding direct sum decompositions of quasiperiodic functions.



---

archive/issue_comments_290361.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> Sage should provide easy access to the corresponding direct sum decompositions of quasiperiodic functions.\n\nCan you please help a computer scientist, where for example in that paper is such a decomposition?",
    "created_at": "2016-08-12T08:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290361",
    "user": "rws"
}
```

Replying to [comment:4 mkoeppe]:
> Sage should provide easy access to the corresponding direct sum decompositions of quasiperiodic functions.

Can you please help a computer scientist, where for example in that paper is such a decomposition?



---

archive/issue_comments_290362.json:
```json
{
    "body": "Or did you mean decomposition into piecewise+linear. Better question: how should the piecewise quasiperiodic be represented textually? What preferred way to input them?",
    "created_at": "2016-08-12T08:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290362",
    "user": "rws"
}
```

Or did you mean decomposition into piecewise+linear. Better question: how should the piecewise quasiperiodic be represented textually? What preferred way to input them?



---

archive/issue_comments_290363.json:
```json
{
    "body": "Replying to [comment:6 rws]:\n> Or did you mean decomposition into piecewise+linear.\n\nTake as an example the floor function.\nIt can be written as x - frac(x). This is the unique way of writing it as a sum of a linear function and a periodic function (whose value is 0 at 0 - a normalization to make it unique).\nThis kind of direct sum decomposition should be accessible by methods of a quasiperiodic.\n\n> Better question: how should the piecewise quasiperiodic be represented textually? \nGood enough for me if is printed as a sum of periodic and linear.\nThe periodic piecewise function could print like a piecewise function, followed by \"extended periodically to R\".\n\n> What preferred way to input them?\n\nNo clear preference. The linear part could perhaps just be an optional argument in the constructor.\nIn the continuous piecewise linear case, I suppose one could have a shortcut to build quasiperiodic extensions of the given function, but this is not very important.",
    "created_at": "2016-08-12T09:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290363",
    "user": "mkoeppe"
}
```

Replying to [comment:6 rws]:
> Or did you mean decomposition into piecewise+linear.

Take as an example the floor function.
It can be written as x - frac(x). This is the unique way of writing it as a sum of a linear function and a periodic function (whose value is 0 at 0 - a normalization to make it unique).
This kind of direct sum decomposition should be accessible by methods of a quasiperiodic.

> Better question: how should the piecewise quasiperiodic be represented textually? 
Good enough for me if is printed as a sum of periodic and linear.
The periodic piecewise function could print like a piecewise function, followed by "extended periodically to R".

> What preferred way to input them?

No clear preference. The linear part could perhaps just be an optional argument in the constructor.
In the continuous piecewise linear case, I suppose one could have a shortcut to build quasiperiodic extensions of the given function, but this is not very important.



---

archive/issue_comments_290364.json:
```json
{
    "body": "By the way, I have some existing code for piecewise linear and quasiperiodic piecewise linear that could probably be adapted. It is based on the old piecewise implementation.\n- https://github.com/mkoeppe/infinite-group-relaxation-code/blob/master/functions.sage#L1183\n- https://github.com/mkoeppe/infinite-group-relaxation-code/blob/master/quasi_periodic.sage",
    "created_at": "2016-08-12T19:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20978#issuecomment-290364",
    "user": "mkoeppe"
}
```

By the way, I have some existing code for piecewise linear and quasiperiodic piecewise linear that could probably be adapted. It is based on the old piecewise implementation.
- https://github.com/mkoeppe/infinite-group-relaxation-code/blob/master/functions.sage#L1183
- https://github.com/mkoeppe/infinite-group-relaxation-code/blob/master/quasi_periodic.sage
