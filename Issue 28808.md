# Issue 28808: build/bin/sage-spkg: Copy contents of build/pkgs/SPKG/spkg-env to the top of spkg-build and spkg-install

Issue created by migration from https://trac.sagemath.org/ticket/29045

Original creator: mkoeppe

Original creation time: 2020-01-19 14:24:40

CC:  embray dimpase tscrim

For many spkgs, the `build/pkgs/SPKG/spkg-build` and `spkg-install` script templates set environment variables before invoking `make`.

This ticket allows to move environment variable settings common between these scripts to a `build/pkgs/SPKG/spkg-env` file, which will be included by `build/bin/sage-spkg` at the top of the generated executable scripts (also named `spkg-build` and `spkg-install`).

Moreover, this ticket adds a command
`sage --buildsh SPKG`
which sources that file in addition to `src/bin/sage-env`.
This makes it easier to test new versions of packages.


---

Comment by git created at 2020-01-20 00:39:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-20 00:51:56

IMHO we are trying to move from using `sage -i` to meaninful `make` targets, e.g. `make foo-clean` for uninstalling spkg `foo`, `make foo` for building/installing, etc.


---

Comment by mkoeppe created at 2020-01-20 01:02:31

But `sage-spkg` is not going away, is it?


---

Comment by dimpase created at 2020-01-20 01:04:48

Erik has been working on these things a lot, he'd be the one to give a better advice.


---

Comment by mkoeppe created at 2020-01-20 01:07:17

Changing status from new to needs_review.


---

Comment by git created at 2020-01-21 20:53:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-21 20:58:08

On top of #29052, could set `SAGE_SHPROMPT_PREFIX=sage-$PKG_NAME-build`.


---

Comment by mkoeppe created at 2020-03-10 22:45:39

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
