# Issue 15717: Polyring_FpT_coerce cannot handle polynomial_modn_dense_ntl

archive/issues_015717.json:
```json
{
    "body": "\n```\nsage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')\nsage: 1/x\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-50-fd72f6c47fe6> in <module>()\n----> 1 Integer(1)/x\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15915)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7514)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7459)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.__div__ (sage/rings/polynomial/polynomial_element.c:17669)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15897)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement._div_ (sage/structure/element.c:16030)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8852)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/fraction_field_FpT.so in sage.rings.fraction_field_FpT.Polyring_FpT_coerce._call_with_args (sage/rings/fraction_field_FpT.cpp:12184)()\n\nTypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint\n```\n\nThis makes NTL modpolys unusable in fractions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15954\n\n",
    "created_at": "2014-03-16T16:43:25Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Polyring_FpT_coerce cannot handle polynomial_modn_dense_ntl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15717",
    "user": "https://github.com/rwst"
}
```

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
sage: 1/x
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-50-fd72f6c47fe6> in <module>()
----> 1 Integer(1)/x

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15915)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7514)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7459)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.__div__ (sage/rings/polynomial/polynomial_element.c:17669)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15897)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement._div_ (sage/structure/element.c:16030)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8852)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/fraction_field_FpT.so in sage.rings.fraction_field_FpT.Polyring_FpT_coerce._call_with_args (sage/rings/fraction_field_FpT.cpp:12184)()

TypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint
```

This makes NTL modpolys unusable in fractions.

Issue created by migration from https://trac.sagemath.org/ticket/15954





---

archive/issue_events_046921.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46921"
}
```



---

archive/issue_comments_203201.json:
```json
{
    "body": "The error happens when (in `Polyring_FpT_coerce._call_with_args`) the argument is converted to `Polynomial_zmod_flint`. As the whole file `fraction_field_FpT.pyx` is using flint, must we implement it completely via ntl, or does it suffice to fix that single conversion?",
    "created_at": "2014-06-05T13:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203201",
    "user": "https://github.com/rwst"
}
```

The error happens when (in `Polyring_FpT_coerce._call_with_args`) the argument is converted to `Polynomial_zmod_flint`. As the whole file `fraction_field_FpT.pyx` is using flint, must we implement it completely via ntl, or does it suffice to fix that single conversion?



---

archive/issue_comments_203202.json:
```json
{
    "body": "As no conversion seems possible, a better error message is displayed.\n----\nNew commits:",
    "created_at": "2014-06-05T14:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203202",
    "user": "https://github.com/rwst"
}
```

As no conversion seems possible, a better error message is displayed.
----
New commits:



---

archive/issue_comments_203203.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-05T14:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203203",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_203204.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-12T07:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_046922.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46922"
}
```



---

archive/issue_events_046923.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46923"
}
```



---

archive/issue_comments_203205.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-20T14:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_203206.json:
```json
{
    "body": "I like this in general but it's really more than just the fractions, it's when you make the field, so it should also show up here, or maybe even when you make the fraction field, I don't know?\n\n```\nsage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')\nsage: R.fraction_field()\nFraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)\nsage: K = R.fraction_field()\nsage: K\nFraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)\nsage: K(1)\n1\nsage: K(2)\n2\nsage: K(x)\nTypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint\n```\n",
    "created_at": "2015-05-21T16:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203206",
    "user": "https://github.com/kcrisman"
}
```

I like this in general but it's really more than just the fractions, it's when you make the field, so it should also show up here, or maybe even when you make the fraction field, I don't know?

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
sage: R.fraction_field()
Fraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)
sage: K = R.fraction_field()
sage: K
Fraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)
sage: K(1)
1
sage: K(2)
2
sage: K(x)
TypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint
```




---

archive/issue_comments_203207.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-21T16:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203207",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_203208.json:
```json
{
    "body": "The issue was resolved independently. In 8.2.beta2 we now get:\n\n```\nsage: R.<x> = PolynomialRing(Integers(101), implementation='NTL')\nsage: 1/x\n...\nNotImplementedError: Fraction fields not implemented for this type.\n```\n",
    "created_at": "2018-01-15T08:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203208",
    "user": "https://github.com/rwst"
}
```

The issue was resolved independently. In 8.2.beta2 we now get:

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='NTL')
sage: 1/x
...
NotImplementedError: Fraction fields not implemented for this type.
```




---

archive/issue_events_046924.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-15T08:27:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46924"
}
```



---

archive/issue_events_046925.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-15T08:27:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46925"
}
```



---

archive/issue_comments_203209.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-01-15T08:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203209",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_203210.json:
```json
{
    "body": "I get a failure already on the first line:\n\n```\nsage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-2-d6c1b40b741c> in <module>()\n----> 1 R = PolynomialRing(Integers(Integer(101)), implementation='ntl', names=('x',)); (x,) = R._first_ngens(1)\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)\n    648         return _multi_variate(base_ring, names, **kwds)\n    649     else:\n--> 650         return _single_variate(base_ring, names, **kwds)\n    651 \n    652 \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in _single_variate(base_ring, name, sparse, implementation, order)\n    734         else:\n    735             constructor = polynomial_ring.PolynomialRing_commutative\n--> 736         implementation_names = constructor._implementation_names(implementation, base_ring, sparse)\n    737         implementation = implementation_names[0]\n    738 \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _implementation_names(cls, implementation, base_ring, sparse)\n    504         if names is NotImplemented:\n    505             raise ValueError(\"unknown implementation %r for %s polynomial rings over %r\" %\n--> 506                     (implementation, \"sparse\" if sparse else \"dense\", base_ring))\n    507         assert isinstance(names, list)\n    508         assert implementation in names\n\nValueError: unknown implementation 'ntl' for dense polynomial rings over Ring of integers modulo 101\n```\n",
    "created_at": "2018-01-15T14:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203210",
    "user": "https://github.com/jdemeyer"
}
```

I get a failure already on the first line:

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-2-d6c1b40b741c> in <module>()
----> 1 R = PolynomialRing(Integers(Integer(101)), implementation='ntl', names=('x',)); (x,) = R._first_ngens(1)

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)
    648         return _multi_variate(base_ring, names, **kwds)
    649     else:
--> 650         return _single_variate(base_ring, names, **kwds)
    651 
    652 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in _single_variate(base_ring, name, sparse, implementation, order)
    734         else:
    735             constructor = polynomial_ring.PolynomialRing_commutative
--> 736         implementation_names = constructor._implementation_names(implementation, base_ring, sparse)
    737         implementation = implementation_names[0]
    738 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _implementation_names(cls, implementation, base_ring, sparse)
    504         if names is NotImplemented:
    505             raise ValueError("unknown implementation %r for %s polynomial rings over %r" %
--> 506                     (implementation, "sparse" if sparse else "dense", base_ring))
    507         assert isinstance(names, list)
    508         assert implementation in names

ValueError: unknown implementation 'ntl' for dense polynomial rings over Ring of integers modulo 101
```




---

archive/issue_comments_203211.json:
```json
{
    "body": "They changed the keyword to `NTL` without matching lower case. With that I get an informative error message.",
    "created_at": "2018-01-15T16:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203211",
    "user": "https://github.com/rwst"
}
```

They changed the keyword to `NTL` without matching lower case. With that I get an informative error message.



---

archive/issue_comments_203212.json:
```json
{
    "body": "Replying to [comment:9 rws]:\n> The issue was resolved independently.\n\nWhich issue was \"solved\"? It still doesn't work.",
    "created_at": "2018-01-15T18:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203212",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 rws]:
> The issue was resolved independently.

Which issue was "solved"? It still doesn't work.



---

archive/issue_comments_203213.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2018-01-15T18:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203213",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_events_046926.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-15T18:01:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46926"
}
```



---

archive/issue_events_046927.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-15T18:01:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15717#event-46927"
}
```



---

archive/issue_comments_203214.json:
```json
{
    "body": "Well I opened the issue and after that decided to be satisfied with a good error. But hijack away...I don't claim ownership.",
    "created_at": "2018-01-15T18:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203214",
    "user": "https://github.com/rwst"
}
```

Well I opened the issue and after that decided to be satisfied with a good error. But hijack away...I don't claim ownership.



---

archive/issue_comments_203215.json:
```json
{
    "body": "I don't personally care... but changing the error message does not fix the issue.",
    "created_at": "2018-01-15T20:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15717#issuecomment-203215",
    "user": "https://github.com/jdemeyer"
}
```

I don't personally care... but changing the error message does not fix the issue.
