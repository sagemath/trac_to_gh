# Issue 15717: Polyring_FpT_coerce cannot handle polynomial_modn_dense_ntl

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-03-16 16:43:25


```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
sage: 1/x
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-50-fd72f6c47fe6> in <module>()
----> 1 Integer(1)/x

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15915)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7514)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7459)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.__div__ (sage/rings/polynomial/polynomial_element.c:17669)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__div__ (sage/structure/element.c:15897)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement._div_ (sage/structure/element.c:16030)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8852)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/fraction_field_FpT.so in sage.rings.fraction_field_FpT.Polyring_FpT_coerce._call_with_args (sage/rings/fraction_field_FpT.cpp:12184)()

TypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint
```

This makes NTL modpolys unusable in fractions.


---

Comment by rws created at 2014-06-05 13:09:01

The error happens when (in `Polyring_FpT_coerce._call_with_args`) the argument is converted to `Polynomial_zmod_flint`. As the whole file `fraction_field_FpT.pyx` is using flint, must we implement it completely via ntl, or does it suffice to fix that single conversion?


---

Comment by rws created at 2014-06-05 14:40:11

As no conversion seems possible, a better error message is displayed.
----
New commits:


---

Comment by rws created at 2014-06-05 14:40:11

Changing status from new to needs_review.


---

Comment by git created at 2014-07-12 07:32:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-20 14:20:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-05-21 16:02:16

I like this in general but it's really more than just the fractions, it's when you make the field, so it should also show up here, or maybe even when you make the fraction field, I don't know?

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
sage: R.fraction_field()
Fraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)
sage: K = R.fraction_field()
sage: K
Fraction Field of Univariate Polynomial Ring in x over Ring of integers modulo 101 (using NTL)
sage: K(1)
1
sage: K(2)
2
sage: K(x)
TypeError: Cannot convert sage.rings.polynomial.polynomial_modn_dense_ntl.Polynomial_dense_mod_p to sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint
```



---

Comment by kcrisman created at 2015-05-21 16:02:16

Changing status from needs_review to needs_work.


---

Comment by rws created at 2018-01-15 08:27:53

The issue was resolved independently. In 8.2.beta2 we now get:

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='NTL')
sage: 1/x
...
NotImplementedError: Fraction fields not implemented for this type.
```



---

Comment by rws created at 2018-01-15 08:27:53

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2018-01-15 14:19:09

I get a failure already on the first line:

```
sage: R.<x> = PolynomialRing(Integers(101), implementation='ntl')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-2-d6c1b40b741c> in <module>()
----> 1 R = PolynomialRing(Integers(Integer(101)), implementation='ntl', names=('x',)); (x,) = R._first_ngens(1)

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)
    648         return _multi_variate(base_ring, names, **kwds)
    649     else:
--> 650         return _single_variate(base_ring, names, **kwds)
    651 
    652 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in _single_variate(base_ring, name, sparse, implementation, order)
    734         else:
    735             constructor = polynomial_ring.PolynomialRing_commutative
--> 736         implementation_names = constructor._implementation_names(implementation, base_ring, sparse)
    737         implementation = implementation_names[0]
    738 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _implementation_names(cls, implementation, base_ring, sparse)
    504         if names is NotImplemented:
    505             raise ValueError("unknown implementation %r for %s polynomial rings over %r" %
--> 506                     (implementation, "sparse" if sparse else "dense", base_ring))
    507         assert isinstance(names, list)
    508         assert implementation in names

ValueError: unknown implementation 'ntl' for dense polynomial rings over Ring of integers modulo 101
```



---

Comment by rws created at 2018-01-15 16:54:00

They changed the keyword to `NTL` without matching lower case. With that I get an informative error message.


---

Comment by jdemeyer created at 2018-01-15 18:00:29

Replying to [comment:9 rws]:
> The issue was resolved independently.

Which issue was "solved"? It still doesn't work.


---

Comment by jdemeyer created at 2018-01-15 18:00:29

Changing status from positive_review to needs_info.


---

Comment by rws created at 2018-01-15 18:59:05

Well I opened the issue and after that decided to be satisfied with a good error. But hijack away...I don't claim ownership.


---

Comment by jdemeyer created at 2018-01-15 20:51:30

I don't personally care... but changing the error message does not fix the issue.
